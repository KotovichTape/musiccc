{% extends "rental/base.html" %}

{% block title %}–ö–∞–±–∏–Ω–µ—Ç —Å–∫–ª–∞–¥—Å–∫–æ–≥–æ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞{% endblock %}

{% block content %}
<h2>–ö–∞–±–∏–Ω–µ—Ç —Å–∫–ª–∞–¥—Å–∫–æ–≥–æ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞</h2>
<p>–í—ã–¥–∞—á–∞ –∏ –ø—Ä–∏—ë–º –≤–æ–∑–≤—Ä–∞—Ç–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è.</p>
<a href="{% url 'logout' %}" class="btn btn-danger">–í—ã–π—Ç–∏</a>

<h3 class="mt-4">üïí –ù–µ–¥–∞–≤–Ω–æ –≤—ã–¥–∞–Ω–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</h3>
{% if recent_issues %}
<table class="table">
    <tr>
        <th>–ö–ª–∏–µ–Ω—Ç</th>
        <th>–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</th>
        <th>–î–∞—Ç—ã –∞—Ä–µ–Ω–¥—ã</th>
        <th>–í—Ä–µ–º—è –≤—ã–¥–∞—á–∏</th>
        <th>–°—Ç–∞—Ç—É—Å</th>
    </tr>
    {% for rental in recent_issues %}
    <tr>
        <td>{{ rental.client.user.username }}</td>
        <td>{{ rental.equipment.name }}</td>
        <td>{{ rental.start_date|date:"d.m.Y" }} - {{ rental.end_date|date:"d.m.Y" }}</td>
        <td>{{ rental.issued_date|date:"d.m.Y H:i" }}</td>
        <td>üîµ –í—ã–¥–∞–Ω–æ</td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p>üì≠ –ù–µ—Ç –Ω–µ–¥–∞–≤–Ω–æ –≤—ã–¥–∞–Ω–Ω–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è.</p>
{% endif %}

<h3 class="mt-4">üìå –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –∑–∞—è–≤–∫–∏</h3>
{% if active_rentals %}
<table class="table">
    <tr>
        <th>–ö–ª–∏–µ–Ω—Ç</th>
        <th>–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</th>
        <th>–î–∞—Ç—ã</th>
        <th>–°—Ç–∞—Ç—É—Å</th>
        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
    </tr>
    {% for rental in active_rentals %}
    <tr id="rental-{{ rental.id }}">
        <td>{{ rental.client.user.username }}</td>
        <td>{{ rental.equipment.name }}</td>
        <td>{{ rental.start_date|date:"d.m.Y" }} - {{ rental.end_date|date:"d.m.Y" }}</td>
        <td class="rental-status">
            {% if rental.status == "issued" %}
                üîµ –í—ã–¥–∞–Ω–æ
            {% elif rental.status == "approved" %}
                üü° –û–∂–∏–¥–∞–µ—Ç –≤—ã–¥–∞—á–∏
            {% endif %}
        </td>
        <td>
            {% if rental.status == "approved" %}
                <form method="post" action="{% url 'issue_equipment' rental.id %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success btn-sm">–í—ã–¥–∞—Ç—å</button>
                </form>
            {% elif rental.status == "issued" %}
                <form method="post" action="{% url 'return_equipment' rental.id %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-warning btn-sm">–ü—Ä–∏–Ω—è—Ç—å –≤–æ–∑–≤—Ä–∞—Ç</button>
                </form>
            {% endif %}
        </td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p>‚úÖ –ù–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –∑–∞—è–≤–æ–∫.</p>
{% endif %}

<h3 class="mt-4">üìú –ò—Å—Ç–æ—Ä–∏—è –≤–æ–∑–≤—Ä–∞—Ç–æ–≤</h3>
{% if rental_history %}
<table class="table">
    <tr>
        <th>–ö–ª–∏–µ–Ω—Ç</th>
        <th>–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</th>
        <th>–î–∞—Ç—ã –∞—Ä–µ–Ω–¥—ã</th>
        <th>–î–∞—Ç–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞</th>
        <th>–°—Ç–∞—Ç—É—Å</th>
        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
    </tr>
    {% for rental in rental_history %}
    <tr id="rental-{{ rental.id }}">
        <td>{{ rental.client.user.username }}</td>
        <td>{{ rental.equipment.name }}</td>
        <td>{{ rental.start_date|date:"d.m.Y" }} - {{ rental.end_date|date:"d.m.Y" }}</td>
        <td>{{ rental.returned_date|date:"d.m.Y H:i" }}</td>
        <td>üü¢ –í–æ–∑–≤—Ä–∞—â–µ–Ω–æ</td>
        <td>
            {% if not rental.equipment.needs_repair %}
                <form method="post" action="/warehouse/send-to-technician/{{ rental.equipment.id }}/" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-info btn-sm">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É</button>
                </form>
            {% else %}
                <span class="text-muted">–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</span>
            {% endif %}
        </td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p>üì≠ –ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞.</p>
{% endif %}

<h3 class="mt-4">üîß –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –≤ —Ä–µ–º–æ–Ω—Ç–µ</h3>
{% if equipment_in_repair %}
<table class="table">
    <tr>
        <th>–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</th>
        <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
        <th>–°—Ç–∞—Ç—É—Å</th>
    </tr>
    {% for equipment in equipment_in_repair %}
    <tr>
        <td>{{ equipment.name }}</td>
        <td>{{ equipment.get_category_display }}</td>
        <td>üîß –í —Ä–µ–º–æ–Ω—Ç–µ</td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p>‚úÖ –ù–µ—Ç –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –≤ —Ä–µ–º–æ–Ω—Ç–µ.</p>
{% endif %}

{% endblock %}
